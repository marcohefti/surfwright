{"id":"A2-MAIN-001","severity":"high","category":"complexity","file":"src/core/target/infra/query/target-extract-frame.ts","line":52,"problem":"A single evaluator callback contains most extract logic for all kinds, creating a high-branch hotspot.","evidence":"One callback begins at line 52 and includes many kind branches at lines 123, 159, 194, 231, 267, 314, and 392; file is 498 LOC.","recommendation":"Split per-kind extract evaluators into dedicated op modules and keep extractFrameItems as dispatcher + normalization only.","risk_if_ignored":"Behavior changes in one extraction kind can regress other kinds due to shared monolithic logic.","effort":"L"}
{"id":"A2-MAIN-002","severity":"high","category":"duplication","file":"src/core/target/infra/target-find.ts","line":238,"problem":"DOM helper logic is duplicated across query/extract/find implementations.","evidence":"selectorHintFor duplicates at target-extract-frame.ts:69, target-attr.ts:186, target-extract-table-rows-op.ts:42, target-find.ts:238; isVisible duplicates at target-extract-frame.ts:56, target-attr.ts:202, target-count.ts:81, target-extract-table-rows-op.ts:29, target-find.ts:254; identical long candidate selector at target-attr.ts:265, target-count.ts:119, target-find.ts:310.","recommendation":"Create shared in-page DOM helper ops (visibility, selector hint, text extraction, candidate selector constant) and reuse them across commands.","risk_if_ignored":"Query behavior can drift between commands, producing inconsistent outputs for operators and agents.","effort":"M"}
{"id":"A2-MAIN-003","severity":"high","category":"duplication","file":"src/core/target/infra/target-read.ts","line":292,"problem":"Target action lifecycle boilerplate is repeated across multiple command handlers.","evidence":"Repeated startedAt/resolvedSessionAt/connectedAt/timing/persist/finally-close pattern appears in target-read.ts:292,305,309,404,409; target-find.ts:149,168,172,436,441; target-extract.ts:197,227,231,440,444; target-eval.ts:140,164,168,433,438.","recommendation":"Introduce a shared withTargetSessionAction helper to standardize session resolution, timing accounting, optional persistence, and browser cleanup.","risk_if_ignored":"Timing/report semantics and persistence behavior can diverge over time, increasing maintenance cost.","effort":"M"}
{"id":"A2-MAIN-004","severity":"medium","category":"cohesion","file":"src/core/target/infra/target-read.ts","line":413,"problem":"One file mixes read and form-fill command concerns.","evidence":"targetRead starts at line 281 and targetFormFill starts at line 413; form-fill parsing/apply helpers occupy lines 53-248; file is 499 LOC.","recommendation":"Split read and form-fill into separate modules and keep shared field parsing helpers in a small shared file.","risk_if_ignored":"Edits for one command can create accidental regressions in the other due to shared file churn.","effort":"M"}
{"id":"A2-MAIN-005","severity":"medium","category":"coupling","file":"src/core/target/infra/target-extract.ts","line":11,"problem":"Extract flow depends on parser utility defined inside eval module, and eval file also owns close behavior.","evidence":"target-extract.ts imports parseJsonObjectText from target-eval.ts at line 11; parseJsonObjectText is defined in target-eval.ts:37; targetClose is also implemented in target-eval.ts:442.","recommendation":"Move parseJsonObjectText into shared parser utilities and move targetClose into its own module.","risk_if_ignored":"Cross-command coupling raises regression risk when modifying eval internals.","effort":"S"}
{"id":"A2-MAIN-006","severity":"medium","category":"cohesion","file":"src/core/browser.ts","line":54,"problem":"Browser module combines platform discovery, process control, and managed session lifecycle orchestration.","evidence":"chromeCandidatesForPlatform at line 54, process kill/liveness paths at lines 193 and 229, startManagedSession at line 268, ensureSessionReachable at line 371, ensureDefaultManagedSession at line 437; file is 484 LOC.","recommendation":"Split browser.ts into discovery, process lifecycle, and managed-session lifecycle modules with narrow exported interfaces.","risk_if_ignored":"Changes to startup or process handling can unintentionally impact session policy behavior.","effort":"L"}
{"id":"A2-MAIN-007","severity":"medium","category":"readability-debt","file":"src/features/runtime/register-commands.ts","line":62,"problem":"Runtime command registration remains monolithic and repetitive.","evidence":"File is 491 LOC. Repeated 'const output = ctx.globalOutputOpts();' at lines 62,82,114,127,140,155,213,249,271,295,319,340,356,371,448 and repeated 'ctx.handleFailure(error, output);' at lines 68,104,119,132,145,160,236,257,282,306,330,348,361,379,474.","recommendation":"Add a withRuntimeAction wrapper and split registration into domain files (open/session/run/update/skill).","risk_if_ignored":"Boilerplate-heavy command wiring slows feature iteration and raises copy-paste error risk.","effort":"M"}
{"id":"A2-MAIN-008","severity":"low","category":"oversized-file","file":"src/core/types/target.ts","line":2,"problem":"All target report contracts are centralized in one large file.","evidence":"target.ts is 499 LOC and contains many report types continuously from lines 2-499.","recommendation":"Split target report types by command area and re-export via barrel index for compatibility.","risk_if_ignored":"Type maintenance friction and merge-conflict frequency will increase as command surface grows.","effort":"M"}
{"id":"A2-MAIN-009","severity":"high","category":"maintainability-risk","file":"src/core/state/infra/state-store.ts","line":206,"problem":"State parse/version failures silently fall back to empty state, which can then be persisted by normal mutations.","evidence":"readStateFromPath returns emptyState on version mismatch at lines 206-208 and on catch at lines 270-271; updateState reads then writes state at lines 309-314.","recommendation":"Treat parse/version failures as typed errors (or quarantine paths) instead of empty fallback, and preserve/backup unreadable state before any write.","risk_if_ignored":"A transient/corrupt read path can become durable state loss after subsequent updateState writes.","effort":"M"}
{"id":"A2-MAIN-010","severity":"high","category":"duplication","file":"src/core/daemon/infra/daemon.ts","line":103,"problem":"Daemon metadata parsing/security logic is duplicated across daemon client and worker and already shows validation drift.","evidence":"Duplicated helpers in daemon.ts and worker.ts: parsePositiveInt (83 vs 35), currentProcessUid (91 vs 43), readDaemonMeta (103 vs 55), removeDaemonMeta (160 vs 92). Client requires startedAt (124-126), worker does not (68-76,85).","recommendation":"Extract shared daemon-meta module for schema validation, permission checks, and meta read/write/remove used by both daemon.ts and worker.ts.","risk_if_ignored":"Control-plane behavior may diverge under stale/partial metadata, increasing daemon lifecycle bugs.","effort":"M"}
{"id":"A2-MAIN-011","severity":"medium","category":"readability-debt","file":"src/core/pipeline-support/infra/plan-types.ts","line":7,"problem":"Pipeline keeps multiple alias IDs and alias-specific branching across lint and execution.","evidence":"Alias IDs are accepted in SUPPORTED_STEP_IDS at lines 7-14; lint branches include alias checks at plan-lint.ts lines 126, 135, 193, 206; execute-shared alias trampolines at lines 130, 289, 344.","recommendation":"Canonicalize each step to one ID at parse boundary and drop alias-specific branches from lint/executor paths.","risk_if_ignored":"Every step evolution must update multiple alias branches, increasing regressions and maintenance cost.","effort":"M"}
{"id":"A2-MAIN-012","severity":"medium","category":"complexity","file":"src/core/pipeline/infra/execute-shared.ts","line":63,"problem":"Pipeline execution engine is monolithic and mixes dispatch, validation, and control-flow logic.","evidence":"451 LOC file with one large PIPELINE_STEP_EXECUTORS map starting at line 63; complex repeat-until DSL execution is inline at lines 131-287.","recommendation":"Split executor by step families and move repeat-until orchestration into its own module with focused tests.","risk_if_ignored":"Future step additions/changes are more likely to regress unrelated execution behavior.","effort":"L"}
{"id":"A2-MAIN-013","severity":"medium","category":"duplication","file":"src/core/pipeline/app/run-ops.ts","line":29,"problem":"Pipeline ops adapter has repetitive pass-through wrappers with broad result casting.","evidence":"422 LOC file; repeated 'as unknown as Record<string, unknown>' casts at lines 29,31,52,76,98,122,174,293,337,359,381,401,419 and near-duplicate forwarding object shapes for each op.","recommendation":"Introduce typed forwarding helpers/factories to reduce wrapper duplication and keep stronger result typing.","risk_if_ignored":"Adapter churn and weak typing will scale poorly as op count and payload complexity grow.","effort":"M"}
